{% extends "layout.html" %}

{% block content %}
<div class="chat-container">
    <!-- Chat Windows (one per task) -->
    <div class="chat-window active" id="chat-summarize">
        <div class="chat-header">
            <i class="bi-file-text"></i>
            <h2>Summarize</h2>
            <p>Condense information while preserving key points</p>
        </div>
        
        <div class="chat-history">
            <div class="message ai">
                <div class="avatar">
                    <i class="bi-robot"></i>
                </div>
                <div class="bubble">
                    Hello! I'm your Summarize assistant. Paste any text and I'll create a concise summary for you.
                </div>
            </div>
        </div>
        
        <!-- Thinking Indicator -->
        <div class="thinking-indicator" id="thinking-summarize">
            <div class="thinking-loader">
                <div class="brain-animation">
                    <div class="brain-part part1"></div>
                    <div class="brain-part part2"></div>
                    <div class="brain-part part3"></div>
                    <div class="brain-part part4"></div>
                </div>
                <p>Processing your request...</p>
            </div>
        </div>
        
        <div class="chat-input">
            <form action="/process" method="POST" class="chat-form" data-task="summarize">
                <input type="hidden" name="function" value="summarize">
                <textarea name="user_input" placeholder="Paste text to summarize..." required></textarea>
                <div class="input-footer">
                    <div class="char-counter">0/2000</div>
                    <button type="submit">
                        <i class="bi-send"></i> Summarize
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="chat-window" id="chat-explain">
        <div class="chat-header">
            <i class="bi-lightbulb"></i>
            <h2>Explain</h2>
            <p>Break down complex topics into simple explanations</p>
        </div>
        
        <div class="chat-history">
            <div class="message ai">
                <div class="avatar">
                    <i class="bi-robot"></i>
                </div>
                <div class="bubble">
                    Hi there! I'm your Explain assistant. Give me any concept or topic and I'll explain it clearly.
                </div>
            </div>
        </div>
        
        <!-- Thinking Indicator -->
        <div class="thinking-indicator" id="thinking-explain">
            <div class="thinking-loader">
                <div class="brain-animation">
                    <div class="brain-part part1"></div>
                    <div class="brain-part part2"></div>
                    <div class="brain-part part3"></div>
                    <div class="brain-part part4"></div>
                </div>
                <p>Processing your request...</p>
            </div>
        </div>
        
        <div class="chat-input">
            <form action="/process" method="POST" class="chat-form" data-task="explain">
                <input type="hidden" name="function" value="explain">
                <textarea name="user_input" placeholder="What would you like me to explain?" required></textarea>
                <div class="input-footer">
                    <div class="char-counter">0/2000</div>
                    <button type="submit">
                        <i class="bi-send"></i> Explain
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="chat-window" id="chat-translate">
        <div class="chat-header">
            <i class="bi-translate"></i>
            <h2>Translate</h2>
            <p>Convert text between languages with nuance</p>
        </div>
        
        <div class="chat-history">
            <div class="message ai">
                <div class="avatar">
                    <i class="bi-robot"></i>
                </div>
                <div class="bubble">
                    Bonjour! I'm your Translation assistant. I can translate between 50+ languages with cultural context.
                </div>
            </div>
        </div>
        
        <!-- Thinking Indicator -->
        <div class="thinking-indicator" id="thinking-translate">
            <div class="thinking-loader">
                <div class="brain-animation">
                    <div class="brain-part part1"></div>
                    <div class="brain-part part2"></div>
                    <div class="brain-part part3"></div>
                    <div class="brain-part part4"></div>
                </div>
                <p>Processing your request...</p>
            </div>
        </div>
        
        <div class="chat-input">
            <form action="/process" method="POST" class="chat-form" data-task="translate">
                <input type="hidden" name="function" value="translate">
                <textarea name="user_input" placeholder="Enter text to translate..." required></textarea>
                <div class="input-footer">
                    <div class="char-counter">0/2000</div>
                    <button type="submit">
                        <i class="bi-send"></i> Translate
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="chat-window" id="chat-code">
        <div class="chat-header">
            <i class="bi-code-slash"></i>
            <h2>Code</h2>
            <p>Generate, debug, and explain programming code</p>
        </div>
        
        <div class="chat-history">
            <div class="message ai">
                <div class="avatar">
                    <i class="bi-robot"></i>
                </div>
                <div class="bubble">
                    Hello, developer! I'm your Code assistant. I can help with code generation, debugging, and explanations.
                </div>
            </div>
        </div>
        
        <!-- Thinking Indicator -->
        <div class="thinking-indicator" id="thinking-code">
            <div class="thinking-loader">
                <div class="brain-animation">
                    <div class="brain-part part1"></div>
                    <div class="brain-part part2"></div>
                    <div class="brain-part part3"></div>
                    <div class="brain-part part4"></div>
                </div>
                <p>Processing your request...</p>
            </div>
        </div>
        
        <div class="chat-input">
            <form action="/process" method="POST" class="chat-form" data-task="code">
                <input type="hidden" name="function" value="code">
                <textarea name="user_input" placeholder="Describe what you need coded..." required></textarea>
                <div class="input-footer">
                    <div class="char-counter">0/2000</div>
                    <button type="submit">
                        <i class="bi-send"></i> Generate Code
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="chat-window" id="chat-creative">
        <div class="chat-header">
            <i class="bi-palette"></i>
            <h2>Creative</h2>
            <p>Generate ideas, stories, and artistic content</p>
        </div>
        
        <div class="chat-history">
            <div class="message ai">
                <div class="avatar">
                    <i class="bi-robot"></i>
                </div>
                <div class="bubble">
                    Hello creative mind! I'm your Creative assistant. Let's brainstorm ideas, write stories, or create art concepts.
                </div>
            </div>
        </div>
        
        <!-- Thinking Indicator -->
        <div class="thinking-indicator" id="thinking-creative">
            <div class="thinking-loader">
                <div class="brain-animation">
                    <div class="brain-part part1"></div>
                    <div class="brain-part part2"></div>
                    <div class="brain-part part3"></div>
                    <div class="brain-part part4"></div>
                </div>
                <p>Processing your request...</p>
            </div>
        </div>
        
        <div class="chat-input">
            <form action="/process" method="POST" class="chat-form" data-task="creative">
                <input type="hidden" name="function" value="creative">
                <textarea name="user_input" placeholder="What would you like to create?" required></textarea>
                <div class="input-footer">
                    <div class="char-counter">0/2000</div>
                    <button type="submit">
                        <i class="bi-send"></i> Create
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Task switching functionality
    document.querySelectorAll('.sidebar-button').forEach(btn => {
        btn.addEventListener('click', function() {
            const task = this.dataset.task;
            
            // Hide all chat windows
            document.querySelectorAll('.chat-window').forEach(win => {
                win.classList.remove('active');
            });
            
            // Show the selected chat window
            document.getElementById(`chat-${task}`).classList.add('active');
        });
    });
    
    // Character counter for textareas
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        const counter = textarea.parentNode.querySelector('.char-counter');
        
        textarea.addEventListener('input', function() {
            const currentLength = this.value.length;
            counter.textContent = `${currentLength}/2000`;
            
            if (currentLength > 2000) {
                this.value = this.value.substring(0, 2000);
                counter.textContent = '2000/2000';
            }
        });
    });
    
    // Form submission handling
    const forms = document.querySelectorAll('.chat-form');
    forms.forEach(form => {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const task = this.dataset.task;
            const button = this.querySelector('button[type="submit"]');
            const textarea = this.querySelector('textarea');
            const indicator = document.getElementById(`thinking-${task}`);
            const chatHistory = this.closest('.chat-window').querySelector('.chat-history');
            
            // Show processing indicator
            if (indicator) {
                indicator.style.display = 'block';
            }
            
            // Disable button
            if (button) {
                button.innerHTML = '<i class="bi-arrow-repeat"></i> Processing...';
                button.disabled = true;
            }
            
            try {
                // Create user message bubble
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.innerHTML = `
                    <div class="avatar">
                        <i class="bi-person"></i>
                    </div>
                    <div class="bubble">
                        ${textarea.value}
                    </div>
                `;
                chatHistory.appendChild(userMessage);
                
                // Simulate processing (in real app, this would be an AJAX call)
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Create AI response (in real app, this would come from server)
                const aiResponse = document.createElement('div');
                aiResponse.className = 'message ai';
                aiResponse.innerHTML = `
                    <div class="avatar">
                        <i class="bi-robot"></i>
                    </div>
                    <div class="bubble">
                        Here is your ${task} response... 
                        <div class="timestamp">Just now</div>
                    </div>
                `;
                chatHistory.appendChild(aiResponse);
                
                // Scroll to bottom
                chatHistory.scrollTop = chatHistory.scrollHeight;
                
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            } finally {
                // Hide processing indicator
                if (indicator) {
                    indicator.style.display = 'none';
                }
                
                // Reset button
                if (button) {
                    button.innerHTML = `<i class="bi-send"></i> ${button.textContent.trim()}`;
                    button.disabled = false;
                }
                
                // Clear textarea
                textarea.value = '';
                textarea.dispatchEvent(new Event('input'));
            }
        });
    });
    
    // Auto-scroll to bottom of chat history
    const chatHistories = document.querySelectorAll('.chat-history');
    chatHistories.forEach(history => {
        history.scrollTop = history.scrollHeight;
    });
});
</script>
{% endblock %}